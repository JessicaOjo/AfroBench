<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AfroBench Leaderboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-900 font-sans">

    <div class="max-w-7xl mx-auto p-6 bg-white rounded-lg shadow-lg">
        <h2 class="text-4xl font-bold text-gray-900 mb-6 text-center">AfroBench Leaderboard</h2>
        
        <!-- Filters Section -->
        <div class="flex flex-wrap gap-4 mb-6 justify-center">
            <!-- Task Filter -->
            <div class="relative">
                <button onclick="toggleDropdown('taskDropdown')" class="p-3 border rounded-lg shadow-sm bg-white text-gray-900 w-56 flex justify-between">
                    <span id="taskSelectedText">All Tasks</span>
                    <span>▼</span>
                </button>
                <div id="taskDropdown" class="absolute hidden bg-white border rounded-lg shadow-lg w-56 mt-2 z-10">
                    <label class="block px-4 py-2">
                        <input type="checkbox" value="all" onclick="selectAll(this, 'taskOptions', 'taskSelectedText')"> All Tasks
                    </label>
                    <div id="taskOptions" class="max-h-40 overflow-y-auto">
                        <!-- Populated via JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Subtask Filter -->
            <div class="relative">
                <button onclick="toggleDropdown('subtaskDropdown')" class="p-3 border rounded-lg shadow-sm bg-white text-gray-900 w-56 flex justify-between">
                    <span id="subtaskSelectedText">All Subtasks</span>
                    <span>▼</span>
                </button>
                <div id="subtaskDropdown" class="absolute hidden bg-white border rounded-lg shadow-lg w-56 mt-2 z-10">
                    <label class="block px-4 py-2">
                        <input type="checkbox" value="all" onclick="selectAll(this, 'subtaskOptions', 'subtaskSelectedText')"> All Subtasks
                    </label>
                    <div id="subtaskOptions" class="max-h-40 overflow-y-auto">
                        <!-- Populated via JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Dataset Filter -->
            <div class="relative">
                <button onclick="toggleDropdown('datasetDropdown')" class="p-3 border rounded-lg shadow-sm bg-white text-gray-900 w-56 flex justify-between">
                    <span id="datasetSelectedText">All Datasets</span>
                    <span>▼</span>
                </button>
                <div id="datasetDropdown" class="absolute hidden bg-white border rounded-lg shadow-lg w-56 mt-2 z-10">
                    <label class="block px-4 py-2">
                        <input type="checkbox" value="all" onclick="selectAll(this, 'datasetOptions', 'datasetSelectedText')"> All Datasets
                    </label>
                    <div id="datasetOptions" class="max-h-40 overflow-y-auto">
                        <!-- Populated via JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Model Filter -->
            <select id="modelFilter" class="p-3 border rounded-lg shadow-sm bg-white text-gray-900 w-56" onchange="updateLeaderboard()">
                <option value="all">All Models</option>
            </select>
        </div>

        <!-- Leaderboard Table -->
        <div class="overflow-x-auto">
            <table class="w-full border-collapse border border-gray-300 bg-white shadow-md rounded-lg">
                <thead id="leaderboardHeader">
                    <tr class="bg-yellow-500 text-white text-lg">
                        <th class="border p-3">Model</th>
                        <th class="border p-3">Size (B)</th>
                        <th class="border p-3">AfroBench Score</th>
                        <th class="border p-3">NLU</th>
                        <th class="border p-3">QA</th>
                        <th class="border p-3">Knowledge</th>
                        <th class="border p-3">Reasoning</th>
                        <th class="border p-3">NLG</th>
                    </tr>
                </thead>
                <tbody id="leaderboardBody"></tbody>
            </table>
        </div>
    </div>

    <script>
        // Dataset-to-Task Mapping
        const DATASET_MAPPING = {
            "MasakhaPOS": ["NLU", "TokC"],
            "MasakhaNER": ["NLU", "TokC"],
            "AfriSenti": ["NLU", "Senti"],
            "NollySenti": ["NLU", "Senti"],
            "InjongoIntent": ["NLU", "Intent"],
            "MasakhaNEWS": ["NLU", "Topic"],
            "SIB": ["NLU", "Topic"],
            "AfriHate": ["NLU", "Hate"],
            "AfriXNLI": ["NLU", "NLI"],
            "AfriQA": ["QA", "XQA"],
            "Belebele": ["QA", "RC"],
            "NaijaRC": ["QA", "RC"],
            "UHURA": ["Knowledge", "Arc-E"],
            "OpenAIMMLU": ["Knowledge", "MMLU"],
            "AfriMMLU": ["Knowledge", "MMLU"],
            "AfriMGSM": ["Reasoning", "Math"],
            "SALT - en_xx": ["NLG", "MT"],
            "SALT - xx_en": ["NLG", "MT"],
            "Flores - en_xx": ["NLG", "MT"],
            "Flores - xx_en": ["NLG", "MT"],
            "MAFAND - en_xx": ["NLG", "MT"],
            "MAFAND - xx_en": ["NLG", "MT"],
            "NTREX - en_xx": ["NLG", "MT"],
            "NTREX - xx_en": ["NLG", "MT"],
            "XLSUM": ["NLG", "Summ"],
            "ADR": ["NLG", "Diacritics"]
        };
    
        // Extract unique tasks
        const TASKS = [...new Set(Object.values(DATASET_MAPPING).map(([task]) => task))];

        function toggleDropdown(id) {
            document.getElementById(id).classList.toggle("hidden");
        }

        // Function to handle selecting/deselecting all checkboxes
        function selectAll(mainCheckbox, optionContainerId, selectedTextId) {
            const checkboxes = document.querySelectorAll(`#${optionContainerId} input[type="checkbox"]`);
            checkboxes.forEach(cb => cb.checked = mainCheckbox.checked);
            updateSelectedText(optionContainerId, selectedTextId);
        }

        // Function to update the displayed selected values
        function updateSelectedText(optionContainerId, selectedTextId) {
            const selectedValues = [];
            document.querySelectorAll(`#${optionContainerId} input[type="checkbox"]:checked`).forEach(cb => {
                if (cb.value !== "all") selectedValues.push(cb.value);
            });

            document.getElementById(selectedTextId).innerText = selectedValues.length ? selectedValues.join(", ") : "All";
            updateLeaderboard();
        }

        // Function to populate dropdown options dynamically
        function populateDropdownOptions(id, options) {
            const container = document.getElementById(id);
            container.innerHTML = "";
            options.forEach(option => {
                container.innerHTML += `
                    <label class="block px-4 py-2">
                        <input type="checkbox" value="${option}" onclick="updateSelectedText('${id}', '${id.replace('Options', 'SelectedText')}')"> ${option}
                    </label>
                `;
            });
        }

        // Function to populate filters dynamically
        function populateFilters() {
            const tasks = [...new Set(Object.values(DATASET_MAPPING).map(([task]) => task))];
            populateDropdownOptions("taskOptions", tasks);

            updateSubtasks();
        }

        // Function to update subtasks based on selected tasks
        function updateSubtasks() {
            const selectedTasks = getSelectedOptions("taskOptions");
            const subtasks = [...new Set(
                Object.values(DATASET_MAPPING)
                    .filter(([task]) => selectedTasks.includes(task))
                    .map(([, subtask]) => subtask)
            )];

            populateDropdownOptions("subtaskOptions", subtasks);
            updateDatasets();
        }

        // Function to update datasets based on selected subtasks
        function updateDatasets() {
            const selectedTasks = getSelectedOptions("taskOptions");
            const selectedSubtasks = getSelectedOptions("subtaskOptions");

            const datasets = Object.keys(DATASET_MAPPING)
                .filter(dataset =>
                    selectedTasks.includes(DATASET_MAPPING[dataset][0]) &&
                    (selectedSubtasks.length === 0 || selectedSubtasks.includes(DATASET_MAPPING[dataset][1]))
                );

            populateDropdownOptions("datasetOptions", datasets);
        }

        // Get selected options from checkboxes
        function getSelectedOptions(containerId) {
            return [...document.querySelectorAll(`#${containerId} input[type="checkbox"]:checked`)]
                .map(cb => cb.value);
        }

        // Initialize filters
        populateFilters();

    
        // function updateLeaderboard() {
        //     console.log("Filtering leaderboard with selected options");
        //     // This function should be implemented to filter and display the leaderboard.
        // }
    
        // // Populate initial task dropdown
        // populateTasks();
    </script>

    <!-- <script>
        let leaderboardData = {};
        let taskMapping = {};

        async function fetchData() {
            const response = await fetch("leaderboard_data.json");
            leaderboardData = await response.json();
            populateTasks();
            updateLeaderboard();
        }

        function populateTasks() {
            const taskSelect = document.getElementById("taskFilter");
            taskMapping = Object.keys(leaderboardData);

            taskMapping.forEach(task => {
                taskSelect.innerHTML += `<option value="${task}">${task}</option>`;
            });
        }

        function updateSubtasks() {
            const selectedTask = document.getElementById("taskFilter").value;
            const subtaskSelect = document.getElementById("subtaskFilter");
            subtaskSelect.innerHTML = `<option value="all">All Subtasks</option>`;

            if (selectedTask !== "all") {
                const subtasks = Object.keys(leaderboardData[selectedTask].subtasks);
                subtasks.forEach(subtask => {
                    subtaskSelect.innerHTML += `<option value="${subtask}">${subtask}</option>`;
                });
            }

            updateDatasets();
        }

        function updateDatasets() {
            const selectedTask = document.getElementById("taskFilter").value;
            const selectedSubtask = document.getElementById("subtaskFilter").value;
            const datasetSelect = document.getElementById("datasetFilter");
            datasetSelect.innerHTML = `<option value="all">All Datasets</option>`;

            if (selectedTask !== "all" && selectedSubtask !== "all") {
                const datasets = Object.keys(leaderboardData[selectedTask].subtasks[selectedSubtask].datasets);
                datasets.forEach(dataset => {
                    datasetSelect.innerHTML += `<option value="${dataset}">${dataset}</option>`;
                });
            }

            updateLeaderboard();
        }

        function updateLeaderboard() {
            const selectedTask = document.getElementById("taskFilter").value;
            const selectedSubtask = document.getElementById("subtaskFilter").value;
            const selectedDataset = document.getElementById("datasetFilter").value;
            const selectedModel = document.getElementById("modelFilter").value;

            const tableBody = document.getElementById("leaderboardBody");
            const tableHeader = document.getElementById("leaderboardHeader");
            tableBody.innerHTML = "";

            if (selectedTask === "all") return;

            let subtaskData = leaderboardData[selectedTask].subtasks;
            if (selectedSubtask !== "all") subtaskData = { [selectedSubtask]: subtaskData[selectedSubtask] };

            let models = new Set();
            Object.values(subtaskData).forEach(subtask => {
                Object.keys(subtask.datasets).forEach(dataset => {
                    if (selectedDataset !== "all" && dataset !== selectedDataset) return;
                    Object.keys(subtask.datasets[dataset].scores).forEach(model => models.add(model));
                });
            });

            models.forEach(model => {
                if (selectedModel !== "all" && model !== selectedModel) return;

                let modelRow = `<tr class="border bg-gray-100 hover:bg-gray-200 transition">
                    <td class="border p-3 font-medium text-gray-900">${model}</td>
                    <td class="border p-3 text-gray-800">-</td>`;

                if (selectedDataset === "all") {
                    let totalScore = 0;
                    let count = 0;

                    Object.values(subtaskData).forEach(subtask => {
                        Object.keys(subtask.datasets).forEach(dataset => {
                            if (subtask.datasets[dataset].scores[model]) {
                                let avgScore = subtask.datasets[dataset].scores[model].reduce((a, b) => a + b, 0) / subtask.datasets[dataset].scores[model].length;
                                totalScore += avgScore;
                                count++;
                            }
                        });
                    });

                    modelRow += `<td class="border p-3 text-center">${(count > 0 ? (totalScore / count).toFixed(1) : "-")}</td>`;
                } else {
                    let datasetScores = subtaskData[selectedSubtask].datasets[selectedDataset].scores[model];
                    datasetScores.forEach(score => {
                        modelRow += `<td class="border p-3 text-center">${score.toFixed(1)}</td>`;
                    });
                }

                modelRow += `</tr>`;
                tableBody.innerHTML += modelRow;
            });
        }

        fetchData();
    </script> -->
</body>
</html>
