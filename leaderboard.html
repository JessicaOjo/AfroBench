<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AfroBench Leaderboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        function toggleLeaderboard(view) {
            document.getElementById("afrobench-view").classList.toggle("hidden", view !== 'afrobench');
            document.getElementById("afrobench-lite-view").classList.toggle("hidden", view !== 'afrobench-lite');
        }
    </script>
</head>
<body class="bg-gray-50 text-gray-900 font-sans">
    
    <!-- Navigation Bar -->
    <nav class="flex justify-between items-center p-6 bg-white shadow-md border-b border-gray-200">
        <div class="flex space-x-6">
            <button onclick="toggleLeaderboard('afrobench')" class="hover:text-yellow-600 font-bold text-lg">AfroBench</button>
            <button onclick="toggleLeaderboard('afrobench-lite')" class="hover:text-yellow-600 font-bold text-lg">AfroBench-Lite</button>
        </div>
        <ul class="flex space-x-6">
            <li><a href="tasks.html" class="hover:text-yellow-600 font-medium">Tasks</a></li>
            <li><a href="index.html" class="hover:text-yellow-600 font-medium">About</a></li>
            <li><a href="http://arxiv.org/abs/2311.07978" class="hover:text-yellow-600 font-medium">Paper</a></li>
        </ul>
    </nav>

        <!-- AfroBench Leaderboard View -->
        <div id="afrobench-view" class="p-6">
            <h2 class="text-3xl font-bold text-center">AfroBench Leaderboard</h2>
            <div class="overflow-x-auto mt-6">
                <table class="w-full border-collapse border border-gray-300 bg-white shadow-md rounded-lg">
                    <thead>
                        <tr class="bg-yellow-600 text-white text-center text-lg">
                            <th rowspan="2" class="border p-3">Rank</th>
                            <th rowspan="2" class="border p-3">Model</th>
                            <th rowspan="2" class="border p-3">Score</th>
                            <th colspan="7" class="border p-3">NLU</th>
                            <th colspan="2" class="border p-3">QA</th>
                            <th colspan="2" class="border p-3">Knowledge</th>
                            <th colspan="1" class="border p-3">Reasoning</th>
                            <th colspan="4" class="border p-3">NLG</th>
                        </tr>
                        <tr class="bg-yellow-600 text-white text-center text-sm">
                            <th class="border p-3">POS</th>
                            <th class="border p-3">NER</th>
                            <th class="border p-3">Senti</th>
                            <th class="border p-3">Topic</th>
                            <th class="border p-3">Intent</th>
                            <th class="border p-3">Hate</th>
                            <th class="border p-3">NLI</th>
                            <th class="border p-3">XQA</th>
                            <th class="border p-3">Arc-E</th>
                            <th class="border p-3">RC</th>
                            <th class="border p-3">MMLU</th>
                            <th class="border p-3">MATH</th>
                            <th class="border p-3">MT<br>(en/fr-xx)</th>
                            <th class="border p-3">MT<br>(xx-en/fr)</th>
                            <th class="border p-3">SUMM</th>
                            <th class="border p-3">ADR</th>
                        </tr>
                    </thead>
                    <tbody id="afrobench-table">
                        <!-- Table rows will be dynamically inserted here -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- AfroBench-Lite Leaderboard View (Hidden by Default) -->
        <div id="afrobench-lite-view" class="p-6 hidden">
            <h2 class="text-3xl font-bold text-center">AfroBench-Lite Leaderboard</h2>
            <div class="overflow-x-auto mt-6">
                <table class="w-full border-collapse border border-gray-300 bg-white shadow-md rounded-lg">
                    <thead>
                        <tr class="bg-yellow-600 text-white text-lg">
                            <th class="border p-3">Rank</th>
                            <th class="border p-3">Model</th>
                            <th class="border p-3">Score</th>
                            <th class="border p-3">Intent</th>
                            <th class="border p-3">Topic</th>
                            <th class="border p-3">NLI</th>
                            <th class="border p-3">RC</th>
                            <th class="border p-3">MMLU</th>
                            <th class="border p-3">MATH</th>
                            <th class="border p-3">MT(en/fr-xx)</th>
                            <th class="border p-3">MT(xx-en/fr)</th>
                        </tr>
                    </thead>
                    <tbody id="afrobench_lite-table">
                        <!-- Table rows will be dynamically inserted here -->
                    </tbody>
                </table>
            </div>
        </div>
    <script>
        let leaderboardData = {};
        let selectedDatasets = [];
        let currentView = "afrobench"; // Default view is AfroBench
    
        // Function to load leaderboard data for AfroBench or AfroBench-Lite
        async function fetchLeaderboardData() {
            const filePath = currentView === "afrobench-lite" ? "leaderboard_json/afrobench_lite.json" : "leaderboard_json/afrobench.json";
            const response = await fetch(filePath);
            leaderboardData = await response.json();
            updateLeaderboard(); // Render table
        }
    
        // Compute per-model scores dynamically (for both views)
        function computeScores() {
            let modelScores = {}; 
        
            if (currentView === "afrobench") {
                // AfroBench JSON structure
                Object.keys(leaderboardData).forEach((task) => {
                    Object.keys(leaderboardData[task]).forEach((subtask) => {
                        Object.keys(leaderboardData[task][subtask].datasets).forEach((dataset) => {
                            let datasetScores = leaderboardData[task][subtask].datasets[dataset];
    
                            Object.keys(datasetScores).forEach((model) => {
                                if (!modelScores[model]) modelScores[model] = {};
                                if (!modelScores[model][subtask]) modelScores[model][subtask] = [];
    
                                if (selectedDatasets.length === 0 || selectedDatasets.includes(dataset)) {
                                    modelScores[model][subtask].push(datasetScores[model]); // Store dataset score
                                }
                            });
                        });
                    });
                });
    
            } else if (currentView === "afrobench-lite") {
                // AfroBench-Lite JSON structure (more direct)
                Object.keys(leaderboardData).forEach((subtask) => {
                    Object.keys(leaderboardData[subtask]).forEach((dataset) => {
                        let datasetScores = leaderboardData[subtask][dataset];
    
                        Object.keys(datasetScores).forEach((model) => {
                            if (!modelScores[model]) modelScores[model] = {};
                            if (!modelScores[model][subtask]) modelScores[model][subtask] = [];
    
                            if (selectedDatasets.length === 0 || selectedDatasets.includes(dataset)) {
                                modelScores[model][subtask].push(datasetScores[model]); // Store dataset score
                            }
                        });
                    });
                });
            }
    
            // Compute final per-model averages
            let finalScores = [];
            Object.keys(modelScores).forEach((model) => {
                let subtasks = modelScores[model];
                let avgScores = {};
                let totalScore = 0;
                let count = 0;
    
                Object.keys(subtasks).forEach((subtask) => {
                    let subtaskAvg = subtasks[subtask].reduce((a, b) => a + b, 0) / subtasks[subtask].length;
                    avgScores[subtask] = subtaskAvg.toFixed(1);
                    totalScore += subtaskAvg;
                    count++;
                });
    
                let overallScore = count > 0 ? (totalScore / count).toFixed(1) : "N/A";
                finalScores.push({ model, overallScore, scores: avgScores });
            });
    
            return finalScores.sort((a, b) => b.overallScore - a.overallScore); // Sort by rank
        }
    
        // Update leaderboard table dynamically (Handles both views)
        function updateLeaderboard() {
            const tableBody = document.querySelector(`#${currentView}-view tbody`);
            tableBody.innerHTML = "";
    
            let computedScores = computeScores();
            computedScores.forEach((entry, index) => {
                let row = `<tr class="border bg-gray-100 hover:bg-gray-200 transition">
                    <td class="border p-3 text-center">${index + 1}</td>
                    <td class="border p-3 font-medium text-gray-900">${entry.model}</td>
                    <td class="border p-3 text-center font-bold text-yellow-600">${entry.overallScore}</td>`;
    
                let relevantSubtasks = currentView === "afrobench-lite"
                    ? ["Topic", "Intent", "NLI", "RC", "MMLU", "Math", "MT(en/fr-xx)", "MT(xx-en/fr)"]
                    : ["POS", "NER", "Senti", "Topic", "Intent", "Hate", "NLI", "XQA", "RC", "Arc-E", "MMLU", "Math", "MT(en/fr-xx)", "MT(xx-en/fr)", "SUMM", "ADR"];
    
                relevantSubtasks.forEach((subtask) => {
                    row += `<td class="border p-3 text-center">${entry.scores[subtask] || "-"}</td>`;
                });
    
                row += "</tr>";
                tableBody.innerHTML += row;
            });
        }
    
        // Handle dataset selection (for future filtering options)
        function toggleDataset(dataset) {
            if (selectedDatasets.includes(dataset)) {
                selectedDatasets = selectedDatasets.filter((d) => d !== dataset);
            } else {
                selectedDatasets.push(dataset);
            }
            updateLeaderboard();
        }
    
        // Function to switch views
        function switchView(view) {
            currentView = view;
            document.getElementById("afrobench-view").style.display = view === "afrobench" ? "block" : "none";
            document.getElementById("afrobench-lite-view").style.display = view === "afrobench-lite" ? "block" : "none";
            fetchLeaderboardData();
        }
    
        // Initialize the page with AfroBench view
        fetchLeaderboardData();
    </script>            
    </body>
    </html>